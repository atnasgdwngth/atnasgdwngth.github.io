"use strict";(self.webpackChunkreact_ssr_webpack_plugin_doc=self.webpackChunkreact_ssr_webpack_plugin_doc||[]).push([[830],{6856:function(e,t,a){a.r(t),a.d(t,{contentTitle:function(){return m},default:function(){return b},frontMatter:function(){return u},metadata:function(){return s},toc:function(){return k}});var n=a(7462),r=a(3366),l=(a(7294),a(3905)),o=(a(6396),a(8215),a(9055)),i=["components"],d={toc:[{value:"ReactSSRMiddleware(compiler, config) \u21d2 <code>Function</code>",id:"reactssrmiddlewarecompiler-config--codefunctioncode",children:[{value:"ReactSSRMiddleware~Function \u21d2 <code>Promise.&lt;void&gt;</code>",id:"reactssrmiddlewarefunction--promisevoid",children:[],level:3},{value:"ReactSSRMiddleware~Config : <code>Object</code>",id:"reactssrmiddlewareconfig--object",children:[{value:"Config~ReqToProps \u21d2 <code>Object</code>",id:"configreqtoprops--object",children:[],level:4},{value:"Config~ResultToRes \u21d2 <code>void</code>",id:"configresulttores--void",children:[],level:4},{value:"Config~PatchGlobal \u21d2 <code>void</code>",id:"configpatchglobal--void",children:[],level:4}],level:3}],level:2}]};function c(e){var t=e.components,a=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("a",{name:"ReactSSRMiddleware"}),(0,l.kt)("h2",{id:"reactssrmiddlewarecompiler-config--codefunctioncode"},"ReactSSRMiddleware(compiler, config) \u21d2 ",(0,l.kt)("a",{parentName:"h2",href:"#ReactSSRMiddleware..Function"},(0,l.kt)("code",null,"Function"))),(0,l.kt)("p",null,"A custom webpack-dev-server middleware for performing server side rendering\nand live reload when server code has modification"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Returns"),": ",(0,l.kt)("a",{parentName:"p",href:"#ReactSSRMiddleware..Function"},(0,l.kt)("code",null,"Function"))," - The middleware function  "),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Param"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"compiler"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The webpack compiler")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"config"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#ReactSSRMiddleware..Config"},(0,l.kt)("code",null,"Config"))),(0,l.kt)("td",{parentName:"tr",align:null},"The middleware config")))),(0,l.kt)("a",{name:"ReactSSRMiddleware..Function"}),(0,l.kt)("h3",{id:"reactssrmiddlewarefunction--promisevoid"},"ReactSSRMiddleware~Function \u21d2 ",(0,l.kt)("code",null,"Promise.","<","void",">")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Param"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"req"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The request object")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"res"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The response object")))),(0,l.kt)("a",{name:"ReactSSRMiddleware..Config"}),(0,l.kt)("h3",{id:"reactssrmiddlewareconfig--object"},"ReactSSRMiddleware~Config : ",(0,l.kt)("code",null,"Object")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Properties")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"patchGlobal"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#ReactSSRMiddleware..Config..PatchGlobal"},(0,l.kt)("code",null,"PatchGlobal"))),(0,l.kt)("td",{parentName:"tr",align:null},"This callback allows you to patch global object without bundling a dependency to the server chunk but you need it at runtime. For example, if cloudflare worker is the production environment, you do not need to include fetch to the server chunk because fetch is runtime api But you need it in your local development environment. Default is ",(0,l.kt)("inlineCode",{parentName:"td"},"() => {}"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"reqToProps"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#ReactSSRMiddleware..Config..ReqToProps"},(0,l.kt)("code",null,"ReqToProps"))),(0,l.kt)("td",{parentName:"tr",align:null},"This callback allows you to convert the request object to ",(0,l.kt)("strong",{parentName:"td"},(0,l.kt)("em",{parentName:"strong"},"a plain object"))," before passing to ",(0,l.kt)("inlineCode",{parentName:"td"},"<App {...props} />"),". If it does not return a plain object, it will return http 500 error. Default is ",(0,l.kt)("inlineCode",{parentName:"td"},"() => ({})"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"resultToRes"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#ReactSSRMiddleware..Config..ResultToRes"},(0,l.kt)("code",null,"ResultToRes"))),(0,l.kt)("td",{parentName:"tr",align:null},"This callback allows you to define your own function to perform http response Default callback supports status code and body.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"version"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"string")),(0,l.kt)("td",{parentName:"tr",align:null},"The version of the JS entry to be executed. If you customize ",(0,l.kt)("inlineCode",{parentName:"td"},"version")," in plugin options, you need to put same value here. Default is ",(0,l.kt)("inlineCode",{parentName:"td"},"manifest"))))),(0,l.kt)("a",{name:"ReactSSRMiddleware..Config..ReqToProps"}),(0,l.kt)("h4",{id:"configreqtoprops--object"},"Config~ReqToProps \u21d2 ",(0,l.kt)("code",null,"Object")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Returns"),": ",(0,l.kt)("code",null,"Object")," - The plain object  "),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Param"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"req"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The request object")))),(0,l.kt)("a",{name:"ReactSSRMiddleware..Config..ResultToRes"}),(0,l.kt)("h4",{id:"configresulttores--void"},"Config~ResultToRes \u21d2 ",(0,l.kt)("code",null,"void")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Param"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"res"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The response object")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"result"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The result object from the entry")))),(0,l.kt)("a",{name:"ReactSSRMiddleware..Config..PatchGlobal"}),(0,l.kt)("h4",{id:"configpatchglobal--void"},"Config~PatchGlobal \u21d2 ",(0,l.kt)("code",null,"void")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Param"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"global"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("code",null,"Object")),(0,l.kt)("td",{parentName:"tr",align:null},"The environment global object")))))}c.isMDXComponent=!0;var p=["components"],u={sidebar_position:2},m="ReactSSRMiddleware",s={unversionedId:"api-reference/middleware",id:"api-reference/middleware",title:"ReactSSRMiddleware",description:"Example",source:"@site/docs/api-reference/middleware.md",sourceDirName:"api-reference",slug:"/api-reference/middleware",permalink:"/react-ssr-webpack-plugin/docs/api-reference/middleware",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/api-reference/middleware.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"ReactSSRWebpackPlugin",permalink:"/react-ssr-webpack-plugin/docs/api-reference/plugin"},next:{title:"ReactSSREntry",permalink:"/react-ssr-webpack-plugin/docs/api-reference/entry"}},k=[{value:"Example",id:"example",children:[],level:2}],g={toc:k};function b(e){var t=e.components,a=(0,r.Z)(e,p);return(0,l.kt)("wrapper",(0,n.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"reactssrmiddleware"},(0,l.kt)("inlineCode",{parentName:"h1"},"ReactSSRMiddleware")),(0,l.kt)(c,{mdxType:"Middleware"}),(0,l.kt)("h2",{id:"example"},"Example"),(0,l.kt)(o.Z,{className:"language-js",title:"webpack.config.js",mdxType:"CodeBlock"},'module.exports = (env, argv) => {\n  const version = `${argv.version}.${argv.mode}`\n  return {\n    "devServer": {\n      "setupMiddlewares": (middlewares, devServer) => ([\n        ...middlewares,\n        {\n          "name": "ReactSSRWebpackPlugin",\n          "path": "*",\n          "middleware": ReactSSRMiddleware(\n            devServer.compiler,\n            {\n              "patchGlobal": (global) => {\n                global.fetch = require("node-fetch")\n              },\n              "reqToProps": (req) => ({\n                "url": url.parse(req.originalUrl, true),\n                "headers": req.headers,\n              }),\n              "resultToRes": (res, result) => {\n                const {body, statusCode} = result;\n                res.writeHead(\n                  statusCode,\n                  {\n                    "Content-Type": "text/html"\n                  }\n                )\n                res.end(result);\n              },\n              version,\n            }\n          ),\n        },\n      ]),\n    }\n  };\n}'))}b.isMDXComponent=!0}}]);